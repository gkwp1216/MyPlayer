# 🚨 위험 몬스터 감지 시스템

## 📁 파일 준비

### 1. warning.png 준비
위험한 몬스터의 스크린샷을 캡처하여 `assets/warning.png`로 저장하세요.

**캡처 방법:**
1. 게임에서 위험 몬스터가 등장했을 때 스크린샷
2. 이미지 편집 프로그램에서 **몬스터만** 잘라내기
3. `assets/warning.png`로 저장

**권장 크기:**
- 너비: 50-200px
- 높이: 50-200px
- 형식: PNG (투명 배경 가능)

**예시:**
```
assets/
└── warning.png  ← 위험 몬스터 이미지
```

---

## 🎯 작동 방식

### 자동 감지
1. **1초마다 화면 체크**
2. `warning.png`와 **70% 이상 일치**하면 감지
3. 즉시 긴급 귀환 실행

### 긴급 귀환 시퀀스
```
1. NPC 클릭 (화면 중앙)
2. 0.3초 대기
3. '예' 버튼 클릭
4. 0.5초 대기
5. 완료!
```

---

## ⚙️ 설정 조정

### NPC/버튼 위치 조정
`src/rl_env_realtime.py`의 `_emergency_escape()` 함수:

```python
# NPC 위치 (화면 기준)
npc_x = screen_width // 2        # 가로 중앙
npc_y = screen_height // 2 + 100 # 중앙에서 100픽셀 아래

# '예' 버튼 위치
yes_x = screen_width // 2        # 가로 중앙
yes_y = screen_height // 2 + 150 # 중앙에서 150픽셀 아래
```

**위치 찾는 법:**
1. 게임에서 NPC 클릭 → 대화창 열기
2. 마우스 커서를 NPC와 '예' 버튼에 올리기
3. 좌표 확인 (Windows: `Win + Shift + S` 후 확인)

### 감지 민감도 조정
```python
if max_val > 0.7:  # 70% 일치 → 0.6 (느슨) ~ 0.9 (엄격)
```

### 체크 주기 조정
```python
self.danger_check_interval = 1.0  # 1초 → 0.5초 (빠름) ~ 2.0초 (느림)
```

---

## 🧪 테스트 방법

### 1. 이미지 준비 확인
```powershell
# 파일 존재 확인
Test-Path assets/warning.png
```

### 2. 환경 실행 시 로그 확인
```
✅ 실시간 RL 환경 초기화 완료
📍 ROI 설정 로드: ['exp_bar']
🚨 위험 몬스터 감지 시스템 활성화  ← 이 메시지 확인!
```

### 3. 실제 게임에서 테스트
1. 위험 몬스터가 등장하는 맵으로 이동
2. 학습 시작
3. 몬스터 등장 시 로그 확인:
```
🚨 위험 몬스터 감지! (일치도: 0.85)
⚡ 긴급 귀환 시작...
✅ 긴급 귀환 완료!
```

---

## 🔧 문제 해결

### Q: "위험 몬스터 이미지 없음" 메시지
**A**: `assets/warning.png` 파일 생성 필요

### Q: 감지는 되는데 클릭이 안 됨
**A**: NPC/버튼 위치 좌표 조정 필요

### Q: 감지가 안 됨
**A**: 
- 이미지가 너무 작거나 큼 (50-200px 권장)
- 임계값을 0.6으로 낮춰보기
- 몬스터 이미지를 더 정확히 캡처

### Q: 너무 자주 감지됨 (오탐)
**A**: 
- 임계값을 0.8-0.9로 높이기
- 몬스터 이미지를 더 특정적으로 캡처
- 체크 주기를 늘리기 (2.0초)

---

## 📌 팁

1. **몬스터 이미지는 명확하게**: 배경이 아닌 몬스터만
2. **여러 각도 대비**: 몬스터가 돌아본 모습도 캡처
3. **테스트 충분히**: 안전한 곳에서 먼저 테스트
4. **좌표는 게임마다 다름**: 직접 측정 필요

---

## 🚀 다음 단계

위험 몬스터 이미지를 준비했다면:

```powershell
# 학습 시작
py tools/train_realtime_rl.py --timesteps 10000
```

이제 위험 몬스터가 등장해도 자동으로 귀환합니다! 🛡️
